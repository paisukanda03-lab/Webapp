<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏£‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Prompt', sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #80deea);
      text-align: center;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      color: #00695c;
      font-size: 2.8em;
      text-shadow: 0 2px 5px rgba(0,0,0,0.2);
      margin-bottom: 10px;
    }
    .instructions {
      margin: 20px;
      font-size: 1.2em;
      color: #004d40;
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 600px;
    }
    .container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .molecules, .target {
      border: 3px dashed #00796b;
      padding: 20px;
      margin: 10px;
      min-width: 240px;
      min-height: 240px;
      background: #b2dfdb;
      border-radius: 15px;
      transition: background 0.3s, transform 0.2s;
    }
    .molecules:hover, .target:hover {
      background: #80cbc4;
      transform: scale(1.02);
    }
    .molecule {
      font-size: 2em;
      margin: 10px;
      padding: 10px;
      cursor: grab;
      transition: transform 0.3s, box-shadow 0.3s;
      border-radius: 8px;
      background: #ffffff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      user-select: none;
      touch-action: none;
    }
    .molecule:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .molecule:active { cursor: grabbing; }
    .molecule.success {
      animation: spin 1s ease-in-out;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin: 15px 0;
    }
    .score, .level, .attempts, .timer, .high-score {
      font-size: 1.3em;
      color: #004d40;
      background: rgba(255,255,255,0.9);
      padding: 10px 15px;
      border-radius: 8px;
      min-width: 120px;
    }
    button {
      padding: 12px 25px;
      font-size: 1.1em;
      background: #00796b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      margin: 5px;
    }
    button:hover {
      background: #004d40;
      transform: scale(1.05);
    }
    .popup {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -20%);
      background: #ffffff;
      border: 3px solid #00796b;
      border-radius: 15px;
      padding: 20px 40px;
      font-size: 1.5em;
      color: #004d40;
      display: none;
      z-index: 100;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -30%); }
      to { opacity: 1; transform: translate(-50%, -20%); }
    }
    .winner {
      font-size: 3.5em;
      animation: bounce 1s infinite alternate;
    }
    @keyframes bounce {
      from { transform: translateY(0); }
      to { transform: translateY(-15px); }
    }
    .mode-toggle {
      margin: 10px;
      font-size: 1em;
    }
  </style>
</head>
<body>

<h1>üß™ ‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏£‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå</h1>
<div class="instructions">
  <p>‡∏•‡∏≤‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ï‡∏∞‡πÇ‡∏°‡πÄ‡∏•‡∏Å‡∏∏‡∏•‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå!</p>
  <p>‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏°‡∏µ 3 ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤</p>
  <p>‡πÇ‡∏´‡∏°‡∏î‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î: ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡πÇ‡∏≠‡∏Å‡∏≤‡∏™</p>
  <p>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="targetCompound">‡πÄ‡∏≠‡∏ó‡∏≤‡∏ô‡∏≠‡∏• (CH3CH2OH)</span></p>
</div>

<div class="mode-toggle">
  <button onclick="toggleMode()">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</button>
</div>

<div class="container">
  <div class="molecules" id="molecules"></div>
  <div class="target" id="target">
    <p>‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÇ‡∏°‡πÄ‡∏•‡∏Å‡∏∏‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏£!</p>
  </div>
</div>

<div class="stats">
  <div class="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score">0</span></div>
  <div class="level">‡∏£‡∏∞‡∏î‡∏±‡∏ö: <span id="level">1</span></div>
  <div class="attempts">‡πÇ‡∏≠‡∏Å‡∏≤‡∏™: <span id="attempts">3</span></div>
  <div class="timer">‡πÄ‡∏ß‡∏•‡∏≤: <span id="time">30</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
  <div class="high-score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: <span id="highScore">0</span></div>
</div>

<div>
  <button onclick="resetTarget()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
  <button onclick="restartGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà</button>
</div>

<div class="popup" id="popup"></div>

<script>
// ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°
let score = 0, level = 1, attempts = 3, timeLeft = 30, isPracticeMode = false;
let timerInterval, highScore = localStorage.getItem('highScore') || 0;

const target = document.getElementById('target');
const moleculesDiv = document.getElementById('molecules');
const popup = document.getElementById('popup');

// ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö
const levels = [
  { compound: '‡πÄ‡∏≠‡∏ó‡∏≤‡∏ô‡∏≠‡∏• (CH3CH2OH)', molecules: ['ch3', 'ch2', 'oh'], score: 10, time: 30 },
  { compound: '‡∏Å‡∏£‡∏î‡πÅ‡∏≠‡∏ã‡∏¥‡∏ï‡∏¥‡∏Å (CH3COOH)', molecules: ['ch3', 'cooh'], score: 15, time: 25 },
  { compound: '‡∏°‡∏µ‡πÄ‡∏ó‡∏ô (CH4)', molecules: ['ch3', 'h'], score: 5, time: 20 },
  { compound: '‡πÇ‡∏û‡∏£‡∏û‡∏≤‡∏ô‡∏≠‡∏• (C3H7OH)', molecules: ['ch3', 'ch2', 'ch2', 'oh'], score: 20, time: 35 },
  { compound: '‡πÄ‡∏ö‡∏ô‡∏ã‡∏µ‡∏ô (C6H6)', molecules: ['c6h6'], score: 25, time: 40 },
  { compound: '‡πÄ‡∏≠‡∏ó‡∏¥‡∏•‡∏≤‡∏°‡∏µ‡∏ô (C2H5NH2)', molecules: ['ch3', 'ch2', 'nh2'], score: 18, time: 30 },
  { compound: '‡∏≠‡∏∞‡∏ã‡∏¥‡πÇ‡∏ï‡∏ô (C3H6O)', molecules: ['ch3', 'co', 'ch3'], score: 22, time: 35 },
  { compound: '‡πÄ‡∏°‡∏ó‡∏≤‡∏ô‡∏≠‡∏• (CH3OH)', molecules: ['ch3', 'oh'], score: 8, time: 20 },
  { compound: '‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏±‡∏•‡∏î‡∏µ‡πÑ‡∏Æ‡∏î‡πå (HCHO)', molecules: ['ch2o'], score: 12, time: 25 },
  { compound: '‡∏Å‡∏•‡∏µ‡πÄ‡∏ã‡∏≠‡∏£‡∏≠‡∏• (C3H8O3)', molecules: ['ch2oh', 'choh', 'ch2oh'], score: 30, time: 45 }
];

// ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏°‡πÄ‡∏•‡∏Å‡∏∏‡∏•
const allMolecules = [
  { id: 'ch3', icon: 'üß¨ CH‚ÇÉ' },
  { id: 'ch2', icon: 'üß¨ CH‚ÇÇ' },
  { id: 'oh', icon: 'üíß OH' },
  { id: 'cooh', icon: 'üî• COOH' },
  { id: 'h', icon: '‚ö° H' },
  { id: 'nh2', icon: 'üß™ NH‚ÇÇ' },
  { id: 'c6h6', icon: '‚≠ï C‚ÇÜH‚ÇÜ' },
  { id: 'co', icon: 'üåü CO' },
  { id: 'ch2o', icon: 'üß™ CH‚ÇÇO' },
  { id: 'ch2oh', icon: 'üíß CH‚ÇÇOH' },
  { id: 'choh', icon: 'üíß CHOH' }
];

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
function updateUI() {
  document.getElementById('score').textContent = score;
  document.getElementById('level').textContent = level;
  document.getElementById('attempts').textContent = isPracticeMode ? '‚àû' : attempts;
  document.getElementById('targetCompound').textContent = levels[level-1].compound;
  document.getElementById('time').textContent = isPracticeMode ? '‚àû' : timeLeft;
  document.getElementById('highScore').textContent = highScore;
  document.querySelector('.mode-toggle button').textContent = isPracticeMode ? '‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥' : '‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î';
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ
function showPopup(msg) {
  popup.innerHTML = msg;
  popup.style.display = 'block';
  setTimeout(() => popup.style.display = 'none', 2500);
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡πÄ‡∏•‡∏Å‡∏∏‡∏•‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢
function populateMolecules() {
  moleculesDiv.innerHTML = '';
  allMolecules.forEach(m => {
    let div = document.createElement('div');
    div.className = 'molecule';
    div.dataset.type = m.id;
    div.draggable = true;
    div.textContent = m.icon;
    moleculesDiv.appendChild(div);
    div.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text', m.id);
    });
  });
}

// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
function resetTarget() {
  target.innerHTML = '<p>‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÇ‡∏°‡πÄ‡∏•‡∏Å‡∏∏‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏£!</p>';
  clearInterval(timerInterval);
  timeLeft = levels[level-1].time;
  if (!isPracticeMode) startTimer();
  updateUI();
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
function startTimer() {
  timerInterval = setInterval(() => {
    timeLeft--;
    updateUI();
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      if (!isPracticeMode) {
        attempts--;
        if (attempts <= 0) {
          endGame(false);
        } else {
          showPopup(`üò¢ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${attempts} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`);
          resetTarget();
        }
      }
    }
  }, 1000);
}

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö
function checkCompound() {
  const moleculesInTarget = Array.from(target.children)
    .filter(el => el.classList.contains('molecule'))
    .map(el => el.dataset.type);
  const curr = levels[level-1];
  if (moleculesInTarget.length === 0) return;
  const sortedTarget = moleculesInTarget.sort();
  const sortedRequired = curr.molecules.sort();
  if (JSON.stringify(sortedTarget) === JSON.stringify(sortedRequired)) {
    let bonus = isPracticeMode ? 0 : Math.floor(timeLeft / 5) * 2;
    score += curr.score + bonus;
    if (score > highScore) {
      highScore = score;
      localStorage.setItem('highScore', highScore);
    }
    target.querySelectorAll('.molecule').forEach(m => m.classList.add('success'));
    showPopup(`üéâ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á ${curr.compound} ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß! ${bonus ? `+${bonus} ‡πÇ‡∏ö‡∏ô‡∏±‡∏™!` : ''}`);
    resetTarget();
    setTimeout(nextLevel, 2500);
  } else {
    if (!isPracticeMode) attempts--;
    if (!isPracticeMode && attempts <= 0) {
      endGame(false);
    } else {
      showPopup(`‚ùå ‡∏ú‡∏¥‡∏î! ${isPracticeMode ? '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà!' : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${attempts} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`}`);
      resetTarget();
    }
  }
  updateUI();
}

// ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
function nextLevel() {
  clearInterval(timerInterval);
  if (level < levels.length) {
    level++;
    attempts = 3;
    timeLeft = levels[level-1].time;
    resetTarget();
    updateUI();
    if (!isPracticeMode) startTimer();
  } else {
    endGame(true);
  }
}

// ‡∏à‡∏ö‡πÄ‡∏Å‡∏°
function endGame(win) {
  clearInterval(timerInterval);
  if (win) {
    popup.innerHTML = `üéâ ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÄ‡∏Å‡∏°! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ${score} <br><span class="winner">üèÜ</span>`;
  } else {
    popup.innerHTML = `üò¢ ‡πÄ‡∏Å‡∏°‡∏à‡∏ö! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
  }
  popup.style.display = 'block';
  setTimeout(() => {
    popup.style.display = 'none';
    score = 0;
    level = 1;
    attempts = 3;
    timeLeft = levels[0].time;
    resetTarget();
    updateUI();
    if (!isPracticeMode) startTimer();
  }, 3500);
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
function restartGame() {
  clearInterval(timerInterval);
  score = 0;
  level = 1;
  attempts = 3;
  timeLeft = levels[0].time;
  isPracticeMode = false;
  resetTarget();
  updateUI();
  startTimer();
}

// ‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î
function toggleMode() {
  isPracticeMode = !isPracticeMode;
  attempts = isPracticeMode ? Infinity : 3;
  clearInterval(timerInterval);
  timeLeft = levels[level-1].time;
  resetTarget();
  updateUI();
  if (!isPracticeMode) startTimer();
}

// Drag & Drop ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ
target.addEventListener('dragover', e => e.preventDefault());
target.addEventListener('drop', e => {
  e.preventDefault();
  const type = e.dataTransfer.getData('text');
  const molData = allMolecules.find(m => m.id === type);
  if (molData) {
    let clone = document.createElement('div');
    clone.className = 'molecule';
    clone.dataset.type = type;
    clone.textContent = molData.icon;
    target.appendChild(clone);
    checkCompound();
  }
});

// Touch events ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
moleculesDiv.addEventListener('touchstart', e => {
  e.preventDefault();
  const touch = e.touches[0];
  const target = touch.target;
  if (target.classList.contains('molecule')) {
    target.dataset.dragging = true;
  }
});
target.addEventListener('touchend', e => {
  const touch = e.changedTouches[0];
  const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
  if (dropTarget && dropTarget.closest('#target')) {
    const type = Array.from(moleculesDiv.children).find(m => m.dataset.dragging).dataset.type;
    const molData = allMolecules.find(m => m.id === type);
    if (molData) {
      let clone = document.createElement('div');
      clone.className = 'molecule';
      clone.dataset.type = type;
      clone.textContent = molData.icon;
      target.appendChild(clone);
      checkCompound();
    }
  }
  Array.from(moleculesDiv.children).forEach(m => delete m.dataset.dragging);
});

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
try {
  populateMolecules();
  resetTarget();
  updateUI();
  startTimer();
} catch (error) {
  console.error('Error initializing game:', error);
  showPopup('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
}
</script>

</body>
</html> 
